I"¢<h3 id="como-publicar-flutter-web-utilizando-github-actions--webhook--hostinger">Como publicar flutter web utilizando Github Actions + webhook + hostinger</h3>

<p>Recentemente atuei com o Github Actions em um projeto mas n√£o tive oportunidade de criar um do zero pra ver como funcionava, dai veio a ideia de criar algo simples e que pudesse postar por aqui, dai como o reposit√≥rio do GearApp √© privado n√£o poderia servir de case pra mostrar publicamente, dai lembrei de um projeto que estava meio jogado e caberia um testes como esse.</p>

<p>A ideia era:</p>
<ol>
  <li>Criar o layout mais b√°sico poss√≠vel com flutter</li>
  <li>Sincronizar os hooks pra assim que publicar em uma branch j√° publicar no hostinger</li>
  <li>Automatizar tudo isso com o Github actions</li>
</ol>

<p>O resumo da ideia em um rabisco seria algo nesse sentido.</p>

<p><img src="./assets/img/github-actions/code-flow.jpeg" alt="Desenho do fluxo de c√≥digo" /></p>

<h3 id="layout">Layout</h3>

<p>O App installer √© um projeto que acabou morrendo e decidi manter o dom√≠nio por ser um nome bem bom, mas tamb√©m disponibilizar a possibilidade para negocia√ß√£o do dom√≠nio e n√£o apenas mostrar que o site n√£o existe. Inicialmente fiz com um construtor da pr√≥pria hostinger e tava ok, mas pra exemplificar o uso do Github Actions vi um bom candidato pra isso.</p>

<p><img src="./assets/img/github-actions/layout.png" alt="Layout do site" /></p>

<p>Al√©m do layout adicionei tamb√©m o copiar para √°rea de transfer√™ncia.</p>

<p>No final vou disponibilizar o link do repo completo.</p>

<h3 id="githooks-no-hostinger">Githooks no hostinger</h3>

<p>Aqui n√£o existe muito mist√©rio, mas pra n√£o deixar de mostrar, vamos aos prints</p>

<p>No painel de hospedagem da hostinger voc√™ pode cadastrar um repo e apontar para um diret√≥rio, assim que o repo for atualizado, voc√™ pode implantar e com isso ele pega tudo que tem na branch e adiciona no diret√≥rio indicado, mas nesse passo, ainda manualmente.</p>

<p><img src="./assets/img/github-actions/repo-to-directory.png" alt="Implanta√ß√£o manual dos arquivos do repo" /></p>

<p>E pra facilitar mais ainda, ao clicar em implanta√ß√£o autom√°tica, √© mostrado um link do hook que o hostinger ir√° escutar caso esteja vinculado ao github. Feito isso, todo push na branch production √© feito todo o processo de substituir os arquivos do diret√≥rio pelos arquivos da branch, assim, atualizando o site ou projeto.</p>

<p><img src="./assets/img/github-actions/implantacao-automatica.png" alt="Implanta√ß√£o autom√°tica" /></p>

<h3 id="estrela-do-show">Estrela do show</h3>

<p>Agora, com tudo j√° montado, faltou apenas o pr√≥prio build utilizando os workflows do github actions e o meu ficou assim:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">name</span><span class="pi">:</span> <span class="s">Publish Web</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">workflow_dispatch</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">main</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Checkout</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v1</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Setup Flutter</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">subosito/flutter-action@v1</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">channel</span><span class="pi">:</span> <span class="s2">"</span><span class="s">stable"</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install dependencies</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">flutter pub get</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Build Web</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">flutter build web --release</span>

      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Deploy</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">cd build/web</span>
          <span class="s">git init</span>
          <span class="s">git config --global user.email leonardobenedeti@gmail.com</span>
          <span class="s">git config --global user.name leonardobenedeti</span>
          <span class="s">git status</span>
          <span class="s">git remote add origin https://$@github.com/leonardobenedeti/appinstaller.git</span>
          <span class="s">git checkout -b production</span>
          <span class="s">git add --all</span>
          <span class="s">git commit -m "Publish by Actions"</span>
          <span class="s">git push origin production -f</span>
</code></pre></div></div>

<p>Mas aqui temos mais detalhes pra funcionar como o <code class="language-plaintext highlighter-rouge">secrets.TOKEN_FOR_BUILD</code>. Pela internet tem v√°rios artigos que mostram como criar o token pra utilizar aqui s√≥ que gostaria de indicar e tamb√©m deixar o cr√©dito de onde tirei essa d√∫vida que foi neste <a href="https://blog.flutterando.com.br/publicando-suas-paginas-flutter-no-github-pages-utilizando-github-action-ab2701cd1f52" target="_blank">post</a> do Toshi Ossada no blog do Flutterando.</p>

<p>E com isso tudo pronto, s√≥ fazer seus commits que tudo vai acontecer autom√°gicamente‚Ä¶ =D</p>

<p><img src="./assets/img/github-actions/workflows.png" alt="Implanta√ß√£o autom√°tica" /></p>

<p>e claro, quando for utilizar algo mais automatiado assim, cuidado com o fluxo pra n√£o sobrepor c√≥digos que n√£o poderiam ser alterados.</p>

<p>E como prometido, aqui vai o <a href="https://github.com/leonardobenedeti/appinstaller" target="_blank">Repo do AppInstaller</a> pra voc√™s conferirem as execu√ß√µes e tudo al√©m que n√£o foi explicado aqui.</p>

:ET